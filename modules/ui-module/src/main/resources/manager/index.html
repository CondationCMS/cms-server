<!--
  #%L
  ui-module
  %%
  Copyright (C) 2023 - 2025 CondationCMS
  %%
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as
  published by the Free Software Foundation, either version 3 of the
  License, or (at your option) any later version.
  
  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.
  
  You should have received a copy of the GNU General Public
  License along with this program.  If not, see
  <http://www.gnu.org/licenses/gpl-3.0.html>.
  #L%
-->
{% macro menuEntry(entry) %}
{% if entry != null && entry.hasChildren() %}
<li class="nav-item dropdown">
	<a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
	   aria-expanded="false">
		{{ entry.name }}
	</a>
	<ul class="dropdown-menu submenu">
		{% for child in entry.getChildren() %}
			{% if child.isDivider() %}
			<li><hr class="dropdown-divider"></li>
			{% elseif child.hasChildren() %}
				{{ menuEntry(child) | raw }}
			{% else %}
			<li><a class="dropdown-item" href="#" data-action-definition='{{ child.getActionDefinition() }}'>{{ child.name }}</a></li>
			{% endif %}
		{% endfor %}
	</ul>
</li>
{% else %}
<li class="nav-item">
	<a class="nav-link" aria-current="page" href="#" data-action-definition='{{ entry.getActionDefinition() }}'>{{ entry.name }}</a>
</li>
{% endif %}
{% endmacro %}
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Manager</title>
		<link href="/manager/bootstrap/bootstrap.min.css" rel="stylesheet" />

		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />

		<script type="module" src="https://unpkg.com/ninja-keys?module"></script>
		<link rel="stylesheet" href="/manager/css/manager.css" />
		<script src="/manager/js/manager.js" type="module"></script>
	</head>
	<body>
		<div id="menu">
			<nav class="navbar navbar-expand-lg navbar-expand-md bg-light">
				<div class="container-fluid">
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse"
							data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
							aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarSupportedContent">
						<ul class="navbar-nav me-auto mb-2 mb-lg-0">
							{% for entry in actionFactory.createMenu().entries() %}
								{{ menuEntry(entry) | raw }}
							{% endfor %}
						</ul>
					</div>
				</div>
			</nav>
		</div>
		<div id="content">
			<iframe id="contentPreview" src="/?preview=true" style="position: absolute; height: 100%; width: 100%; border: none" ></iframe>
		</div>

		<script src="/manager/bootstrap/bootstrap.bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs/loader.js"></script>

		<script src="/manager/js/ui-actions.js"></script>

		<div id="modalContainer"></div>
		<div id="sidebarContainer"></div>
		<div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3"></div>

	<ninja-keys> </ninja-keys>

	<script>

var shortCuts = [
	{% for entry in actionFactory.createShortCuts() %}
	{
		id: '{{ entry.id }}',
		title: '{{ entry.title }}',
		hotkey: '{{ entry.hotkey }}',
		icon: '{{ entry.icon }}',
		section: '{{ entry.section }}',
		handler: () => {
			var action = {{ entry.getActionDefinition() | raw }}
			if (action.type === "hook") {
				executeHookAction(action)
			} else if (action.type === "script") {
				executeScriptAction(action)
			}
		}
	},
	{% endfor %}
];
const ninja = document.querySelector('ninja-keys');
ninja.data = shortCuts;
	</script>
</body>
</html>
